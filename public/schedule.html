<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø© â€” Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø±</title>
  <link rel="stylesheet" href="./assets/app.css"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* Ø§Ø­ØªÙŠØ§Ø· Ù„Ùˆ CSS Ø¹Ù†Ø¯Ùƒ Ù‚Ø¯ÙŠÙ… */
    .cardsGrid{display:grid;gap:12px}
    .mealCardPro{position:relative;overflow:hidden}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;font-size:12px;color:#475569}
    .muted{color:#64748b;font-size:13px}
    .row2{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .actionsCol{display:flex;flex-direction:column;gap:8px;min-width:180px}
    @media (max-width:720px){.actionsCol{min-width:unset}}
  </style>
</head>

<body>
<div class="container">

  <div class="header">
    <div class="title">
      <h1 id="pageTitle">Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©</h1>
      <div class="sub">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ â€” Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªÙ‚ÙˆÙŠÙ… Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</div>
    </div>
    <div class="toolbar">
      <a class="btn secondary" href="./login.html">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>
    </div>
  </div>

  <!-- Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø§Ø³Ø¨Ø© + Ø¹Ø¯Ø§Ø¯ -->
  <div id="nextBox" class="nextBanner" style="display:none"></div>

  <!-- Ø£Ø¯ÙˆØ§Øª -->
  <div class="stickyBar">
    <div class="row2">
      <span class="badge" id="monthBadge">â€”</span>
      <span class="badge">ğŸ“ <b style="color:#111827" id="loc">Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©</b></span>
    </div>

    <div class="row2">
      <input id="monthPick" class="input" type="month" style="width:160px"/>
      <button id="reload" class="btn secondary">ØªØ­Ø¯ÙŠØ«</button>
      <button id="togglePast" class="btn secondary">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</button>
    </div>

    <div class="chips" id="chips">
      <button class="chip active" data-filter="all">Ø§Ù„ÙƒÙ„</button>
      <button class="chip" data-filter="futoor">ÙØ·ÙˆØ±</button>
      <button class="chip" data-filter="ghada">ØºØ¯Ø§</button>
      <button class="chip" data-filter="asha">Ø¹Ø´Ø§</button>
      <button class="chip" data-filter="suhoor">Ø³Ø­ÙˆØ±</button>
      <button class="chip" data-filter="upcoming">Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</button>
      <button class="chip" data-filter="past">Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</button>
    </div>
  </div>

  <div id="msg" class="notice">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„â€¦</div>

  <div class="card" style="margin-top:12px">
    <div style="font-weight:800">Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø´Ù‡Ø±</div>
    <div class="small">Ø§Ù„ÙŠÙˆÙ… Ù…Ù…ÙŠØ² â€” Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø´Ø¨Ù‡ Ù…Ø®ÙÙŠØ© ÙˆÙŠÙ…ÙƒÙ† Ø¥Ø®ÙØ§Ø¤Ù‡Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.</div>
    <div class="hr"></div>
    <div id="list">â€”</div>
  </div>

</div>

<script type="module">
  import { SUPABASE_URL, SUPABASE_ANON_KEY, APP_TITLE, DEFAULT_LOCATION, TZ } from "./assets/config.js";

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const $ = (id) => document.getElementById(id);
  const pad2 = (n) => String(n).padStart(2,"0");

  $("pageTitle").textContent = APP_TITLE;
  $("loc").textContent = DEFAULT_LOCATION;

  let activeFilter = "all";
  let cachedRows = [];
  let showPast = true;
  let nextMeal = null;
  let countdownTimer = null;

  function getMonthParam(){
    const u = new URL(location.href);
    const m = u.searchParams.get("month");
    if (m && /^\d{4}-\d{2}$/.test(m)) return m;
    const d = new Date();
    return d.getFullYear() + "-" + pad2(d.getMonth()+1);
  }

  function monthLabel(month){
    const parts = month.split("-");
    const y = Number(parts[0]), m = Number(parts[1]);
    const d = new Date(Date.UTC(y, m-1, 1));
    return new Intl.DateTimeFormat("ar-SA", { year:"numeric", month:"long", timeZone: TZ }).format(d);
  }

  function mealLabel(key){
    const map = { futoor:"ÙØ·ÙˆØ±", ghada:"ØºØ¯Ø§", asha:"Ø¹Ø´Ø§", suhoor:"Ø³Ø­ÙˆØ±" };
    return map[key] || key;
  }

  function formatGregorianDayAndDate(iso){
    const d = new Date(iso);
    const weekday = new Intl.DateTimeFormat("ar-SA", { weekday:"long", timeZone: TZ }).format(d);
    const ymd = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).format(d);
    const arr = ymd.split("-");
    const y = arr[0], m = arr[1], da = arr[2];
    return weekday + " " + da + "/" + m + "/" + y;
  }

  function formatHijriWithPrefix(iso){
    const d = new Date(iso);
    try{
      const h = new Intl.DateTimeFormat("ar-SA-u-ca-islamic-umalqura", { year:"numeric", month:"long", day:"numeric", timeZone: TZ }).format(d);
      return "Ø§Ù„Ù…ÙˆØ§ÙÙ‚ " + h;
    }catch(e){
      return "Ø§Ù„Ù…ÙˆØ§ÙÙ‚ â€”";
    }
  }

  function formatTime12(iso){
    const d = new Date(iso);
    return new Intl.DateTimeFormat("ar-SA", { hour:"numeric", minute:"2-digit", hour12:true, timeZone: TZ }).format(d);
  }

  function isTodayTZ(iso){
    const a = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).format(new Date(iso));
    const b = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).format(new Date());
    return a === b;
  }

  function formatCountdown(ms){
    if (ms <= 0) return "Ø¨Ø¯Ø£Øª Ø§Ù„Ø¢Ù†";
    const s = Math.floor(ms/1000);
    const days = Math.floor(s/86400);
    const hrs  = Math.floor((s%86400)/3600);
    const mins = Math.floor((s%3600)/60);
    if (days > 0) return "Ø¨Ø§Ù‚ÙŠ " + days + " ÙŠÙˆÙ… Ùˆ " + hrs + " Ø³Ø§Ø¹Ø©";
    if (hrs > 0)  return "Ø¨Ø§Ù‚ÙŠ " + hrs + " Ø³Ø§Ø¹Ø© Ùˆ " + mins + " Ø¯Ù‚ÙŠÙ‚Ø©";
    return "Ø¨Ø§Ù‚ÙŠ " + mins + " Ø¯Ù‚ÙŠÙ‚Ø©";
  }

  function setMessage(kind, text){
    $("msg").className = kind ? ("notice " + kind) : "notice";
    $("msg").textContent = text;
  }

  function setFilter(f){
    activeFilter = f;
    const chips = document.querySelectorAll(".chip");
    chips.forEach(btn => btn.classList.toggle("active", btn.dataset.filter === f));
    renderCards();
  }

  $("chips").addEventListener("click", (e) => {
    const btn = e.target.closest(".chip");
    if (!btn) return;
    setFilter(btn.dataset.filter);
  });

  $("togglePast").addEventListener("click", () => {
    showPast = !showPast;
    $("togglePast").textContent = showPast ? "Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©" : "Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©";
    renderCards();
  });

  $("reload").addEventListener("click", () => loadMonth($("monthPick").value));
  $("monthPick").addEventListener("change", () => loadMonth($("monthPick").value));

  function pickNextUpcoming(rows){
    const now = new Date();
    const upcoming = rows
      .filter(r => new Date(r.starts_at) >= now)
      .sort((a,b)=> new Date(a.starts_at) - new Date(b.starts_at));
    return upcoming.length ? upcoming[0] : null;
  }

  function showNextBanner(r){
    const box = $("nextBox");
    if (!r){
      box.style.display = "none";
      return;
    }
    const g = formatGregorianDayAndDate(r.starts_at);
    const h = formatHijriWithPrefix(r.starts_at);
    const t = formatTime12(r.starts_at) + " â€“ " + formatTime12(r.ends_at);

    box.style.display = "block";
    box.innerHTML = "";
    const line1 = document.createElement("div");
    line1.innerHTML = "â­ï¸ <b>Ø£Ù‚Ø±Ø¨ Ù…Ù†Ø§Ø³Ø¨Ø©:</b> " + mealLabel(r.meal);
    const line2 = document.createElement("div");
    line2.className = "small";
    line2.textContent = "ğŸ“… " + g;
    const line3 = document.createElement("div");
    line3.className = "small";
    line3.textContent = "ğŸ•Œ " + h;
    const line4 = document.createElement("div");
    line4.className = "small";
    line4.textContent = "â° " + t;
    const line5 = document.createElement("div");
    line5.style.marginTop = "6px";
    const cd = document.createElement("b");
    cd.id = "countDown";
    cd.textContent = "â³ ...";
    line5.appendChild(cd);

    box.appendChild(line1);
    box.appendChild(line2);
    box.appendChild(line3);
    box.appendChild(line4);
    box.appendChild(line5);
  }

  function runCountdown(){
    if (countdownTimer) clearInterval(countdownTimer);
    countdownTimer = null;

    if (!nextMeal) return;

    const tick = () => {
      const el = document.getElementById("countDown");
      if (!el) return;
      const ms = new Date(nextMeal.starts_at) - new Date();
      el.textContent = "â³ " + formatCountdown(ms);
    };

    tick();
    countdownTimer = setInterval(tick, 30000);
  }

  function makeIcs(title, description, location, start, end){
    const dt = (d) => {
      const y=d.getUTCFullYear(), mo=pad2(d.getUTCMonth()+1), da=pad2(d.getUTCDate());
      const hh=pad2(d.getUTCHours()), mm=pad2(d.getUTCMinutes()), ss=pad2(d.getUTCSeconds());
      return "" + y + mo + da + "T" + hh + mm + ss + "Z";
    };
    const esc = (s) => String(s||"").replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;");
    const uid = (crypto.randomUUID ? crypto.randomUUID() : (Date.now()+"")) + "@dawriya-rest";
    const lines = [
      "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Dawriya Rest//AR//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH",
      "BEGIN:VEVENT",
      "UID:" + uid,
      "DTSTAMP:" + dt(new Date()),
      "DTSTART:" + dt(start),
      "DTEND:" + dt(end),
      "SUMMARY:" + esc(title),
      "DESCRIPTION:" + esc(description),
      "LOCATION:" + esc(location),
      "END:VEVENT",
      "END:VCALENDAR"
    ];
    return lines.join("\r\n");
  }

  function downloadIcs(text, filename){
    const blob = new Blob([text], { type:"text/calendar;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 1500);
  }

  function openWhatsAppShare(text){
    const url = "https://wa.me/?text=" + encodeURIComponent(text);
    window.open(url, "_blank");
  }

  function renderCards(){
    const now = new Date();
    let rows = cachedRows.slice();

    if (activeFilter === "upcoming") rows = rows.filter(r => new Date(r.starts_at) >= now);
    else if (activeFilter === "past") rows = rows.filter(r => new Date(r.starts_at) < now);
    else if (activeFilter !== "all") rows = rows.filter(r => r.meal === activeFilter);

    if (!rows.length){
      $("list").innerHTML = '<div class="notice">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø¶Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„ÙÙ„ØªØ±.</div>';
      return;
    }

    // ØªØ±ØªÙŠØ¨: Ø§Ù„ÙŠÙˆÙ… Ø£ÙˆÙ„Ù‹Ø§ØŒ Ø«Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©ØŒ Ø«Ù… Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
    rows.sort((a,b)=>{
      const aToday = isTodayTZ(a.starts_at) ? 0 : 1;
      const bToday = isTodayTZ(b.starts_at) ? 0 : 1;
      if (aToday !== bToday) return aToday - bToday;
      const aPast = new Date(a.starts_at) < now ? 1 : 0;
      const bPast = new Date(b.starts_at) < now ? 1 : 0;
      if (aPast !== bPast) return aPast - bPast;
      return new Date(a.starts_at) - new Date(b.starts_at);
    });

    const wrap = document.createElement("div");
    wrap.className = "cardsGrid";

    rows.forEach(r=>{
      const isPast = new Date(r.starts_at) < now;
      const isToday = isTodayTZ(r.starts_at);
      const isNext = nextMeal && r.id === nextMeal.id;

      if (isPast && !showPast && activeFilter !== "past") return;

      const hosts = (r._hostNames && r._hostNames.length) ? r._hostNames.join(" â€“ ") : "â€”";
      const g = formatGregorianDayAndDate(r.starts_at);
      const h = formatHijriWithPrefix(r.starts_at);
      const t = formatTime12(r.starts_at) + " â€“ " + formatTime12(r.ends_at);

      const card = document.createElement("div");
      card.className = "card mealCardPro mealCard";
      card.dataset.meal = r.meal;

      // Ø§Ù„Ù…Ø§Ø¶ÙŠØ© Ø´Ø¨Ù‡ Ù…Ø®ÙÙŠØ©
      if (isPast){
        card.style.opacity = "0.45";
        card.style.filter = "grayscale(.2)";
      }

      // Ø§Ù„ÙŠÙˆÙ… / Ø§Ù„Ø£Ù‚Ø±Ø¨ Ø¥Ø¨Ø±Ø§Ø²
      if (isToday){
        card.style.border = "1px solid rgba(245,158,11,.55)";
        card.style.background = "rgba(245,158,11,.06)";
      } else if (isNext){
        card.style.border = "1px solid rgba(34,197,94,.55)";
        card.style.background = "rgba(34,197,94,.06)";
      }

      const top = document.createElement("div");
      top.className = "mealTopPro";

      const left = document.createElement("div");

      const badge = document.createElement("div");
      badge.className = "mealBadge";
      badge.textContent = "ğŸ½ï¸ " + mealLabel(r.meal);

      const meta = document.createElement("div");
      meta.className = "mealMeta";
      meta.style.marginTop = "8px";

      const lineA = document.createElement("div");
      lineA.innerHTML = "<b style='color:#0f172a'>ğŸ“… " + g + "</b>";
      const lineB = document.createElement("div");
      lineB.textContent = "ğŸ•Œ " + h;
      const lineC = document.createElement("div");
      lineC.textContent = "â° " + t;

      meta.appendChild(lineA);
      meta.appendChild(lineB);
      meta.appendChild(lineC);

      left.appendChild(badge);
      left.appendChild(meta);

      const tagText = isToday ? "ğŸ“ Ø§Ù„ÙŠÙˆÙ…" : (isNext ? "â­ï¸ Ø§Ù„Ø£Ù‚Ø±Ø¨" : "");
      if (tagText){
        const pill = document.createElement("span");
        pill.className = "pill";
        pill.style.marginTop = "10px";
        pill.textContent = tagText;
        left.appendChild(pill);
      }

      const actions = document.createElement("div");
      actions.className = "actionsCol";

      const btnIcs = document.createElement("button");
      btnIcs.className = "btn secondary primaryAction";
      btnIcs.textContent = "ğŸ“… Ø£Ø¶Ù Ù„Ù„ØªÙ‚ÙˆÙŠÙ…";
      btnIcs.addEventListener("click", ()=>{
        const title = APP_TITLE + " â€” " + mealLabel(r.meal);
        const descParts = [
          mealLabel(r.meal),
          "ğŸ“… " + g,
          "ğŸ•Œ " + h,
          "â° " + t,
          "ğŸ“ " + DEFAULT_LOCATION,
          "ğŸ‘¥ Ø§Ù„Ø¯Ø§Ø¹ÙŠÙ†: " + hosts
        ];
        if (r.notes) descParts.push("ğŸ“ " + r.notes);
        const desc = descParts.join("\\n");
        const ics = makeIcs(title, desc, DEFAULT_LOCATION, new Date(r.starts_at), new Date(r.ends_at));
        const ymd = new Intl.DateTimeFormat("en-CA", { timeZone: TZ, year:"numeric", month:"2-digit", day:"2-digit" }).format(new Date(r.starts_at));
        downloadIcs(ics, APP_TITLE + "-" + mealLabel(r.meal) + "-" + ymd + ".ics");
      });

      const btnWa = document.createElement("button");
      btnWa.className = "btn";
      btnWa.style.background = "#25D366";
      btnWa.textContent = "ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨";
      btnWa.addEventListener("click", ()=>{
        const msg = [
          "ğŸ½ï¸ " + mealLabel(r.meal),
          "ğŸ“… " + g,
          "ğŸ•Œ " + h,
          "â° " + t,
          "ğŸ“ " + DEFAULT_LOCATION,
          "ğŸ‘¥ Ø§Ù„Ø¯Ø§Ø¹ÙŠÙ†: " + hosts
        ];
        if (r.notes) msg.push("ğŸ“ " + r.notes);
        msg.push("");
        msg.push(location.href);
        openWhatsAppShare(msg.join("\n"));
      });

      actions.appendChild(btnIcs);
      actions.appendChild(btnWa);

      top.appendChild(left);
      top.appendChild(actions);

      const hostsBlock = document.createElement("div");
      hostsBlock.className = "hostsBlock";
      const ht = document.createElement("div");
      ht.className = "hostsTitle";
      ht.textContent = "Ø§Ù„Ø¯Ø§Ø¹ÙŠÙ†";
      const hn = document.createElement("div");
      hn.className = "hostsNames";
      hn.textContent = hosts;
      hostsBlock.appendChild(ht);
      hostsBlock.appendChild(hn);

      if (r.notes){
        const note = document.createElement("div");
        note.className = "small";
        note.style.marginTop = "8px";
        note.textContent = "Ù…Ù„Ø§Ø­Ø¸Ø©: " + r.notes;
        hostsBlock.appendChild(note);
      }

      card.appendChild(top);
      card.appendChild(hostsBlock);

      wrap.appendChild(card);
    });

    $("list").innerHTML = "";
    $("list").appendChild(wrap);
  }

  async function loadMonth(m){
    $("monthPick").value = m;
    $("monthBadge").textContent = monthLabel(m);

    setMessage("", "Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„â€¦");
    $("list").textContent = "â€”";

    // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù‡Ø±
    const start = m + "-01T00:00:00+03:00";
    const parts = m.split("-");
    const yy = Number(parts[0]), mm = Number(parts[1]);
    const endDate = new Date(Date.UTC(yy, mm, 1, 0,0,0)); // Ø£ÙˆÙ„ ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ
    const end = endDate.getUTCFullYear() + "-" + pad2(endDate.getUTCMonth()+1) + "-" + pad2(endDate.getUTCDate()) + "T00:00:00+03:00";

    const resMeals = await supabase
      .from("meals")
      .select("id, meal, starts_at, ends_at, notes")
      .gte("starts_at", start)
      .lt("starts_at", end)
      .order("starts_at", { ascending:true });

    if (resMeals.error){
      setMessage("warn", "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + resMeals.error.message);
      $("nextBox").style.display = "none";
      nextMeal = null;
      runCountdown();
      return;
    }

    const rows = resMeals.data || [];
    if (!rows.length){
      setMessage("", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.");
      $("list").innerHTML = '<div class="notice">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø§Ø³Ø¨Ø§Øª.</div>';
      $("nextBox").style.display = "none";
      cachedRows = [];
      nextMeal = null;
      runCountdown();
      return;
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø¹ÙŠÙ†
    const mealIds = rows.map(r=>r.id);
    const resLinks = await supabase
      .from("meal_hosts")
      .select("meal_id, member_id")
      .in("meal_id", mealIds);

    const links = (resLinks && resLinks.data) ? resLinks.data : [];
    const memberIds = Array.from(new Set(links.map(x=>x.member_id)));
    const membersMap = new Map();

    if (memberIds.length){
      const resMembers = await supabase
        .from("members")
        .select("id, full_name")
        .in("id", memberIds);

      const mems = (resMembers && resMembers.data) ? resMembers.data : [];
      mems.forEach(m => membersMap.set(m.id, m.full_name));
    }

    const hostsByMeal = new Map();
    links.forEach(l=>{
      if (!hostsByMeal.has(l.meal_id)) hostsByMeal.set(l.meal_id, []);
      hostsByMeal.get(l.meal_id).push(membersMap.get(l.member_id) || "â€”");
    });

    rows.forEach(r=>{
      r._hostNames = (hostsByMeal.get(r.id) || []).filter(Boolean);
    });

    cachedRows = rows;

    setMessage("ok", "ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„.");
    nextMeal = pickNextUpcoming(rows);
    showNextBanner(nextMeal);
    runCountdown();
    renderCards();
  }

  // init
  const initialMonth = getMonthParam();
  $("monthPick").value = initialMonth;
  $("monthBadge").textContent = monthLabel(initialMonth);
  loadMonth(initialMonth);
</script>

</body>
</html>
